# 最少知识原则

LKP 说的是一个软件实体应当尽可能少地与其他实体发生相互作用。这里的软件实体是一个广义的概念，不仅包括对象，还包括系统、类、模块、函数、变量等。本节我们主要针对对象来说明这个原则。

## 减少对象之间的联系

单一职责原则指导我们把对象划分成较小的粒度，这可以提高对象的可复用性。但越来越多的对象之间可能会产生错综复杂的联系。如果修改了其中一个对象，很可能会影响到跟它相互引用的其他对象。对象和对象耦合在一起，有可能会降低它们的可复用性。

最少知识原则要求我们在设计程序时，应当尽量少地减少对象之间的交互。如果两个对象之间不必彼此直接通信，那么这两个对象就不要发生直接的相互联系。常见的做法是引入一个第三者对象，来承担这些对象之间的通信作用。如果一些对象需要向另一些对象发起请求，可以通过第三者对象来转发这些请求。

## 设计模式中的最少知识原则

1. 中介者模式

买房，通过中介（买家与卖家没有必然的联系）

2. 外观模式

代码实现：

    var A = function() {
      a1();
      a2();
    }
    var B = function() {
      b1();
      b2();
    }
    var facade = function() {
      A();
      B();
    }
    facade();

主要为子系统中的一组接口提供一个一致的界面，外观模式定义了一个高层接口，这个接口使子系统更加容易使用。

外面模式的主要作用有以下两点：

1. 为一组子系统提供一个简单便利的访问入口
2. 格力客户与负责子系统之间的联系，客户不用去了解子系统的细节


## 封装在最少知识原则中的体现

封装在很大程度上表达的是数据的隐藏。一个模块或者对象可以将内部的数据或者实现细节隐藏起来，只暴露必要的接口API供外界访问。 对象之间难免产生联系，当一个对象必须引用另一个对象时，我们可以让对象只暴露必要的接口，让对象之间的联系限制在最小的范围之内。
同时，封装也用来限制变量的作用域。在JS中对变量作用域的规定是：

1. 变量在全局声明，或者在代码的任何位置隐式申明（不用var）则该变量在全局可见
2. 变量在函数内显示申明（使用var）则在函数内可见

把变量的可见性限制在一个尽可能小的范围内，这个变量对其他不关心模块的影响就越小，变量被改写和发生冲突的机会也越小。这也是广义的最少知识原则的一种体现。

例子，代码如下：

var mult = (function() {
  var cache = {};

  return function() {
    var args = Array.prototype.join.call(arguments, ',');
    if (cache[args]) {
      return cache[args];
    }
    var a = 1;
    for (var i = 0, l = arguments.length; i < l; i++) {
      a = a * arguments[i];
    }
    return cache[args] = a;
  }
})();