{"version":3,"sources":["../../src/koa/21.js"],"names":["Koa","require","os","path","koaBody","app","main","ctx","tmpdir","filePaths","files","request","body","key","file","filePath","join","temdir","name","reader","fs","createReadStream","writer","createWriteStream","pipe","push","use","multipart","listen"],"mappings":";;;;;;;;;;;;AAAA;;;;AAIA,IAAMA,MAAMC,QAAQ,KAAR,CAAZ;AACA,IAAMC,KAAKD,QAAQ,IAAR,CAAX;AACA,IAAME,OAAOF,QAAQ,MAAR,CAAb;AACA,IAAMG,UAAUH,QAAQ,UAAR,CAAhB;AACA,IAAMI,MAAM,IAAIL,GAAJ,EAAZ;;AAEA,IAAMM;AAAA,sFAAO,iBAAeC,GAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AACLC,kBADK,GACIN,GAAGM,MAAH,EADJ;AAELC,qBAFK,GAEO,EAFP;AAGLC,iBAHK,GAGGH,IAAII,OAAJ,CAAYC,IAAZ,CAAiBF,KAAjB,IAA0B,EAH7B;;;AAKX,iBAASG,GAAT,IAAgBH,KAAhB,EAAuB;AACfI,kBADe,GACRJ,MAAMG,GAAN,CADQ;AAEfE,sBAFe,GAEJZ,KAAKa,IAAL,CAAUC,MAAV,EAAkBH,KAAKI,IAAvB,CAFI;AAGfC,oBAHe,GAGNC,GAAGC,gBAAH,CAAoBP,KAAKX,IAAzB,CAHM;AAIfmB,oBAJe,GAINF,GAAGG,iBAAH,CAAqBR,QAArB,CAJM;;AAKrBI,qBAAOK,IAAP,CAAYF,MAAZ;AACAb,wBAAUgB,IAAV,CAAeV,QAAf;AACD;;AAEDR,gBAAIK,IAAJ,GAAWH,SAAX;;AAdW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAP;;AAAA;AAAA;AAAA;AAAA,GAAN;;AAiBAJ,IAAIqB,GAAJ,CAAQtB,QAAQ;AACduB,aAAW;AADG,CAAR,CAAR;AAGAtB,IAAIqB,GAAJ,CAAQpB,IAAR;AACAD,IAAIuB,MAAJ,CAAW,IAAX","file":"21.js","sourcesContent":["/**\r\n !c 文件上传\r\n ?c koa-body 模块还可以用来处理文件上传\r\n */\r\nconst Koa = require('koa')\r\nconst os = require('os')\r\nconst path = require('path')\r\nconst koaBody = require('koa-body')\r\nconst app = new Koa()\r\n\r\nconst main = async function(ctx) {\r\n  const tmpdir = os.tmpdir()\r\n  const filePaths = []\r\n  const files = ctx.request.body.files || {}\r\n\r\n  for (let key in files) {\r\n    const file = files[key]\r\n    const filePath = path.join(temdir, file.name)\r\n    const reader = fs.createReadStream(file.path)\r\n    const writer = fs.createWriteStream(filePath)\r\n    reader.pipe(writer)\r\n    filePaths.push(filePath)\r\n  }\r\n\r\n  ctx.body = filePaths\r\n}\r\n\r\napp.use(koaBody({\r\n  multipart: true\r\n}))\r\napp.use(main)\r\napp.listen(3000)"]}