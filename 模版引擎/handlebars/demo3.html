<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Handerbars 3</title>
  <style>
    .card{
      font-size: 30px;
      float: left;
      margin: 20px;
      background: pink;
    }
  </style>
  <script id="card-template" type="text/x-handlebars-template">
    {{#each this}}
    <div class="card">
      <div>{{chinese @index}}</div>
      <div>姓名：{{name}}</div>
      {{#if birth}}
      <div>出生日期：{{birth}}</div>
      {{/if}}
      <div>出生地：{{home}}</div>
      <div>职业：{{job}}</div>
      <ul>
        {{#each books}}
        <li {{#isfirst @index}}style="color:red;" {{/isfirst}} {{#if ../blue}}style="color:blue;"{{/if}}>          
          {{addone @../index}}-{{addone @index}} {{this}}
        </li>
        {{/each}}
      </ul>
    </div>
    {{/each}}
  </script>
</head>
<body>
  <!--<div class="card">
    <div>姓名：凯文米特尼克</div>
    <div>出生日期：1963年8月6日</div>
    <div>出生地：美国洛杉矶</div>
    <div>职业：网络安全咨询师</div>
  </div>-->
  <div id="card">
  </div>
  <script src="./js/jquery.js"></script>
  <script src="./js/handlebars.js"></script>
  <script>
    var data = [
      {
        name: '凯文米特尼克',
        birth: '1963年8月6日',
        home: '美国洛杉矶',
        job: '网络安全咨询师',
        books: ['《欺骗的艺术》', '《入侵的艺术》', '《线上幽灵》']
      },
      {
        name: '沃兹尼亚克',
        birth: '1950年8月11日',
        home: '美国加利福尼亚',
        job: '网络工程师',
        books: ['《与苹果一起疯狂》']
      },
      {
        name: 'channingbreeze',
        home: '北京',
        job: '全栈工程师'
      }
    ]
    // var str = '';
    // str += "<div>姓名：" + data.name + "</div>";
    // str += "<div>出生日期：" + data.birth + "</div>";
    // str += "<div>出生地：" + data.home + "</div>";
    // str += "<div>职业：" + data.job + "</div>";
    // $('#card').html(str);

    /* 使用handlebars */
    Handlebars.registerHelper('chinese', function(value) {
      var arr = ['一', '二', '三'];

      if (this.books && this.books.length > 2) {
        this.blue = 1;
      }
      return arr[value];
    });

    Handlebars.registerHelper('addone', function(value) {
      return value + 1;
    });

    Handlebars.registerHelper('isfirst', function(value, options) {
      if (value === 0) {
        return options.fn(this);
      }
    });

    Handlebars.registerHelper('isblue', function(value, options) {
      if (value && value.length > 2) {
        return options.fn(this);
      }
    });

    var t = $('#card-template').html();
    // console.log(t);  其实就是模版 template
    var f = Handlebars.compile(t);
    // console.log(f);
    // function ret(context, execOptions) {
	  //   if (!compiled) {
	  //     compiled = compileInput();
	  //   }
	  //   return compiled.call(this, context, execOptions);
	  // }
    var h = f(data);
    // console.log(h);
    $('#card').html(h);
  </script>
</body>
</html>